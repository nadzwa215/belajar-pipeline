  # ✅ JOB BARU: AUTO DEPLOY KE KUBERNETES
  deploy-kubernetes:
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main'  # Hanya deploy dari main branch
    
    steps:
    - name: 🛎️ Checkout code
      uses: actions/checkout@v4

    - name: 🔐 Setup Kubernetes
      uses: azure/setup-kubectl@v3
      
    - name: 📁 Setup KUBECONFIG
      run: |
        mkdir -p ~/.kube
        echo "${{ secrets.KUBECONFIG }}" > ~/.kube/config
        kubectl cluster-info

    - name: 🚀 Deploy to Rancher
      run: |
        echo "🔧 Deploying to Rancher Kubernetes..."
        kubectl apply -f kubc/first-app.yaml
        kubectl rollout status deployment/steven-display
        kubectl get pods
        echo "✅ Deployed to Kubernetes!"