name: Advanced CI/CD Pipeline with Multiple Displays

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - name: ğŸ›ï¸ Checkout code
      uses: actions/checkout@v4

    - name: ğŸ” Run Tests
      run: |
        echo "ğŸ§ª Testing all display files..."
        test -f index.html && echo "âœ… index.html exists"
        test -f sarah-display.html && echo "âœ… sarah-display.html exists"
        test -f jules-display.html && echo "âœ… jules-display.html exists"
        test -f style.css && echo "âœ… style.css exists"
        echo "ğŸ‰ All display files present!"

  build:
    runs-on: ubuntu-latest
    needs: test
    steps:
    - name: ğŸ›ï¸ Checkout code
      uses: actions/checkout@v4

    - name: ğŸ—ï¸ Build Docker Image
      run: |
        echo "ğŸ³ Building Docker image with all displays..."
        docker build -t belajar-app-multi .
        echo "âœ… Docker image built with 3 different views!"

  # STAGING DEPLOYMENT (Steven - Default View)
  deploy-staging:
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/develop'
    environment: staging
    steps:
    - name: ğŸš€ Deploy to Staging (Steven)
      run: |
        echo "========================================"
        echo "ğŸš€ DEPLOYING TO STAGING - STEVEN'S DISPLAY"
        echo "========================================"
        echo "ğŸ¯ Display: Steven's Monitor"
        echo "ğŸ“Š View: Default (index.html)"
        echo "ğŸŒ Access URL: https://staging.your-app.com"
        echo "ğŸ“ Primary File: index.html"
        echo "âœ… Staging deployment ready for Steven!"
        echo "========================================"

  # PRODUCTION DEPLOYMENT - SARAH'S METRICS DASHBOARD
  deploy-sarah-metrics:
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main'
    environment: production
    steps:
    - name: ğŸ“Š Deploy Sarah's Metrics Dashboard
      run: |
        echo "========================================"
        echo "ğŸ“Š DEPLOYING SARAH'S METRICS DASHBOARD"
        echo "========================================"
        echo "ğŸ¯ Display: Sarah's Performance Monitor"
        echo "ğŸ“Š View: Metrics Dashboard"
        echo "ğŸŒ Access URL: https://prod.your-app.com/sarah-display.html"
        echo "ğŸ“ Primary File: sarah-display.html"
        echo "ğŸ“ˆ Features: Response Time, Uptime, Active Users, Error Rate"
        echo "âœ… Sarah's Metrics Dashboard deployed!"
        echo "========================================"

  # PRODUCTION DEPLOYMENT - JULES'S SHOW-METER
  deploy-jules-showmeter:
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main'
    environment: production  
    steps:
    - name: ğŸª Deploy Jules's Show-meter
      run: |
        echo "========================================"
        echo "ğŸª DEPLOYING JULES'S SHOW-METER"
        echo "========================================"
        echo "ğŸ¯ Display: Jules's Performance Show-meter"
        echo "ğŸ“Š View: Live Performance Visualization"
        echo "ğŸŒ Access URL: https://prod.your-app.com/jules-display.html"
        echo "ğŸ“ Primary File: jules-display.html"
        echo "ğŸ“ˆ Features: Performance Gauge, CPU/Memory Metrics, Live Updates"
        echo "âœ… Jules's Show-meter deployed!"
        echo "========================================"

  # FINAL VERIFICATION
  verify-deployment:
    runs-on: ubuntu-latest
    needs: [deploy-staging, deploy-sarah-metrics, deploy-jules-showmeter]
    if: always()
    steps:
    - name: âœ… Verify All Deployments
      run: |
        echo "========================================"
        echo "âœ… DEPLOYMENT VERIFICATION COMPLETE"
        echo "========================================"
        echo "ğŸ¯ Staging (Steven): DEFAULT VIEW âœ…"
        echo "ğŸ“Š Production (Sarah): METRICS DASHBOARD âœ…" 
        echo "ğŸª Production (Jules): SHOW-METER DISPLAY âœ…"
        echo "========================================"
        echo "ğŸ‰ ALL DISPLAYS DEPLOYED SUCCESSFULLY!"
        echo "========================================"