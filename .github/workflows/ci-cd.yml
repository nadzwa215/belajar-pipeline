  # ğŸš€ AUTO DEPLOY KE KUBERNETES RANCHER
  deploy-kubernetes:
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main'  # Hanya deploy dari main branch
    
    steps:
    - name: ğŸ›ï¸ Checkout code
      uses: actions/checkout@v4

    - name: ğŸ” Setup Kubernetes
      uses: azure/setup-kubectl@v3
      
    - name: ğŸ“ Setup KUBECONFIG
      run: |
        mkdir -p ~/.kube
        echo "${{ secrets.KUBECONFIG }}" > ~/.kube/config
        kubectl cluster-info
        echo "âœ… Connected to Rancher Kubernetes!"

    - name: ğŸš€ Deploy to Rancher
      run: |
        echo "========================================"
        echo "ğŸš€ DEPLOYING TO RANCHER KUBERNETES"
        echo "========================================"
        kubectl apply -f kubc/first-app.yaml
        kubectl rollout status deployment/steven-display --timeout=180s
        kubectl get deployments
        kubectl get services
        kubectl get pods -l app=steven-display
        echo "âœ… Successfully deployed to Rancher Kubernetes!"
        echo "========================================"

    - name: ğŸ“Š Deployment Info
      run: |
        echo "ğŸ‰ FULLY AUTOMATED DEPLOYMENT COMPLETE!"
        echo "ğŸŒ Cluster: Rancher Desktop"
        echo "ğŸ“± Application: Steven Display"
        echo "ğŸ”— Access: kubectl port-forward service/steven-service 8080:80"
        echo "ğŸ•’ Timestamp: $(date)"