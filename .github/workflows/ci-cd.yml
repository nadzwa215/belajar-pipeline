name: Advanced CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]  # â† PASTIKAN ADA 'develop' DI SINI
  pull_request:
    branches: [ main, develop ]  # â† DAN DI SINI JUGA

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - name: ğŸ›ï¸ Checkout code
      uses: actions/checkout@v4

    - name: ğŸ” Run Tests
      run: |
        echo "ğŸ§ª Running tests for branch: ${{ github.ref }}"
        echo "âœ… All files present and valid"

  build:
    runs-on: ubuntu-latest
    needs: test
    steps:
    - name: ğŸ›ï¸ Checkout code
      uses: actions/checkout@v4

    - name: ğŸ—ï¸ Build Docker Image
      run: |
        echo "ğŸ³ Building Docker image for branch: ${{ github.ref }}"
        docker build -t belajar-app .
        echo "âœ… Docker image built successfully!"

  # DEPLOY BERDASARKAN BRANCH
  deploy-staging:
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/develop'  # â† KHUSUS UNTUK DEVELOP
    steps:
    - name: ğŸš€ Deploy to Staging (Steven)
      run: |
        echo "========================================"
        echo "ğŸš€ DEPLOYING TO STAGING (STEVEN)"
        echo "========================================"
        echo "ğŸ¯ Environment: Staging"
        echo "ğŸ“± Display: Steven's Monitor"
        echo "ğŸŒ Branch: develop"
        echo "ğŸ•’ Timestamp: $(date)"
        echo "âœ… Staging deployment completed!"
        echo "========================================"

  deploy-production:
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main'  # â† KHUSUS UNTUK MAIN
    steps:
    - name: ğŸš€ Deploy to Production (Sarah & Jules)
      run: |
        echo "========================================"
        echo "ğŸš€ DEPLOYING TO PRODUCTION (SARAH + JULES)"
        echo "========================================"
        echo "ğŸ¯ Environment: Production"
        echo "ğŸ“± Displays: Sarah's Monitor + Jules's Show-meter"
        echo "ğŸŒ Branch: main"
        echo "ğŸ•’ Timestamp: $(date)"
        echo "âœ… Production deployment completed!"
        echo "========================================"